<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8"> </head>

<body>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue@2.5.13/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <div id="nd108">
    <el-form :id="'nd108-form'" :ref="'nd108-form'">
      <el-row>
        <el-col :span=8>
          <el-form-item label="页面元素ID" :id="'nd108-form-item1'" :ref="'nd108-form-item1'">
            <el-input v-model="ds.obj.fields.docId" :id="'nd108-form-item1-text'" :ref="'nd108-form-item1-text'"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span=8>
          <el-form-item label="样式" :id="'nd108-form-item2'" :ref="'nd108-form-item2'">
            <el-input v-model="ds.obj.fields.cssNames" :id="'nd108-form-item2-text'" :ref="'nd108-form-item2-text'"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span=8>
          <el-form-item label="顺序" :id="'nd108-form-item3'" :ref="'nd108-form-item3'">
            <el-input v-model="ds.obj.fields.displayOrder" :id="'nd108-form-item3-text'" :ref="'nd108-form-item3-text'"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span=8>
          <el-form-item label="绑定" :id="'nd108-form-item5'" :ref="'nd108-form-item5'">
            <el-input v-model="ds.obj.fields.bindData" :id="'nd108-form-item5-text'" :ref="'nd108-form-item5-text'" modelstring="ds.obj.fields.bindData"></el-input>
            <el-button :id="'nd108-form-item5-button'" :ref="'nd108-form-item5-button'" @click="queryBindName('nd108-form-item5-button','nd108-dsDialog')"
              refcomponent="nd108-form-item5-text" refparameter="userDefine.bindComponent">搜索</el-button>
          </el-form-item>
        </el-col>
        <el-col :span=8>
          <el-form-item label="引用容器" :id="'nd108-form-item6'" :ref="'nd108-form-item6'">
            <el-input v-model="ds.obj.fields.refComponent" :id="'nd108-form-item6-text'" :ref="'nd108-form-item6-text'" modelstring="ds.obj.fields.refComponent"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span=8>
          <el-form-item label="引用自定义参数" :id="'nd108-form-item7'" :ref="'nd108-form-item7'">
            <el-input v-model="ds.obj.fields.refParameter" :id="'nd108-form-item7-text'" :ref="'nd108-form-item7-text'" modelstring="ds.obj.fields.refParameter"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span=8>
          <el-form-item :id="'nd108-form-item4'" :ref="'nd108-form-item4'">
            <el-button :id="'nd108-form-item4-button'" :ref="'nd108-form-item4-button'" @click="saveForLayoutComponent('nd108-form-item4-button')"
              binddata="ds.obj" bindndcode="108" callbackobj="ds.obj" url="http://10.88.1.11:18120/layout/layout/saveComponentNv/"
              parentid="data=url.parentId">保存</el-button>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
    <div :id="'nd108-event'" :ref="'nd108-event'">
      <el-button @click="newEvent('nd108-eventDialog')" :id="'nd108-event-add'" :ref="'nd108-event-add'">添加</el-button>
      <el-table :id="'nd108-event-table'" :ref="'nd108-event-table'" :data="ds.obj.childrens.LEvent" datastring="ds.obj.childrens.LEvent">
        <el-table-column label="触发名" :id="'nd108-event-table-column1'" :ref="'nd108-event-table-column1'">
          <template slot-scope="scope">
            <el-input v-model="scope.row.fields.tiggerName" :id="'nd108-event-table-column1-text'+scope.$index" :ref="'nd108-event-table-column1-text'+scope.$index"></el-input>
          </template>
        </el-table-column>
        <el-table-column label="方法名" :id="'nd108-event-table-column2'" :ref="'nd108-event-table-column2'">
          <template slot-scope="scope">
            <el-input v-model="scope.row.fields.functionName" :id="'nd108-event-table-column2-text'+scope.$index" :ref="'nd108-event-table-column2-text'+scope.$index"></el-input>
          </template>
        </el-table-column>
        <el-table-column label="参数" :id="'nd108-event-table-column3'" :ref="'nd108-event-table-column3'">
          <template slot-scope="scope">
            <el-input v-model="scope.row.fields.functionParam" :id="'nd108-event-table-column3-text'+scope.$index" :ref="'nd108-event-table-column3-text'+scope.$index"></el-input>
          </template>
        </el-table-column>
      </el-table>
    </div>
    <el-dialog :id="'nd108-dsDialog'" :ref="'nd108-dsDialog'" @close="closeDialog('nd108-dsDialog')">
      <el-form :id="'nd108-dsDialog-form'" :ref="'nd108-dsDialog-form'">
        <el-row>
          <el-col>
            <el-form-item :id="'nd108-dsDialog-form-item1'" :ref="'nd108-dsDialog-form-item1'">
              <el-button :id="'nd108-dsDialog-form-item1-button'" :ref="'nd108-dsDialog-form-item1-button'" @click="newDs('nd108-newDsDialog','126','newDs')">新建</el-button>
            </el-form-item>
          </el-col>
          <el-col>
            <el-form-item :id="'nd108-dsDialog-form-item2'" :ref="'nd108-dsDialog-form-item2'">
              <el-tree :ref="'nd108-dsDialog-form-item2-tree'" :id="'nd108-dsDialog-form-item2-tree'" :data="ds.layoutTreeData" node-key="layoutTreeId"
                refparameter="userDefine.bindComponent" :props="{children: 'layoutTreeChildren',label: 'layoutTreeName'}" @node-click="handleNodeClick"
                @dblclick.native="treeDoubleClickForDs('nd108-dsDialog-form-item2-tree','nd108-dsDialog')"></el-tree>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </el-dialog>
    <el-dialog :ref="'nd108-newDsDialog'" :id="'nd108-newDsDialog'" @close="closeDialog('nd108-newDsDialog')">
      <el-form :id="'nd108-newDsDialog-form'" :ref="'nd108-newDsDialog-form'">
        <el-row>
          <el-col>
            <el-form-item label="名称" :id="'nd108-newDsDialog-form-item1'" :ref="'nd108-newDsDialog-form-item1'">
              <el-input v-model="ds.newDs.fields.tiggerName" :id="'nd108-newDsDialog-form-item1-text'" :ref="'nd108-newDsDialog-form-item1-text'"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item label="方法名" :id="'nd108-newDsDialog-form-item2'" :ref="'nd108-newDsDialog-form-item2'">
              <el-input v-model="ds.newDs.fields.functionName" :id="'nd108-newDsDialog-form-item2-text'" :ref="'nd108-newDsDialog-form-item2-text'"
                modelstring="ds.newDs.fields.functionName"></el-input>
              <el-button :id="'nd108-newDsDialog-form-item2-button'" :ref="'nd108-newDsDialog-form-item2-button'" refcomponent="nd108-newDsDialog-form-item2-text"
                refparameter="userDefine.bindFunction" @click="queryFunctionName('nd108-newDsDialog-form-item2-button','nd108-functionDialog')">查找</el-button>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item label="参数" :id="'nd108-newDsDialog-form-item3'" :ref="'nd108-newDsDialog-form-item3'">
              <el-input v-model="ds.newDs.fields.functionParam" :id="'nd108-newDsDialog-form-item3-text'" :ref="'nd108-newDsDialog-form-item3-text'"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item label="绑定ND" :id="'nd108-newDsDialog-form-item4'" :ref="'nd108-newDsDialog-form-item4'">
              <el-input v-model="ds.newDs.fields.expandInfo" :id="'nd108-newDsDialog-form-item4-text'" :ref="'nd108-newDsDialog-form-item4-text'"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item :id="'nd108-newDsDialog-form-item5'" :ref="'nd108-newDsDialog-form-item5'">
              <el-button :id="'nd108-newDsDialog-form-item5-button'" :ref="'nd108-newDsDialog-form-item5-button'" @click="saveForLayoutDs('nd108-newDsDialog-form-item5-button')"
                binddata="ds.newDs" bindndcode="126" callbackobj="ds.newDs" url="http://10.88.1.11:18120/layout/layout/saveTiggerFunctionNv/"
                parentid="data=url.layoutId">保存</el-button>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </el-dialog>
    <el-dialog :ref="'nd108-functionDialog'" :id="'nd108-functionDialog'" @close="closeDialog('nd108-functionDialog')" refcomponent="nd108-functionDialog-collapse">
      <el-collapse :id="'nd108-functionDialog-collapse'" :ref="'nd108-functionDialog-collapse'" accordion v-model="userDefine.activeName"
        modelstring="userDefine.activeName">
        <el-collapse-item title="查询" name="1" :id="'nd108-functionDialog-collapse-item1'" :ref="'nd108-functionDialog-collapse-item1'">
          <el-form :id="'nd108-functionDialog-collapse-item1-form'" :ref="'nd108-functionDialog-collapse-item1-form'">
            <el-row>
              <el-col>
                <el-form-item label="方法名" :id="'nd108-functionDialog-collapse-item1-form-item1'" :ref="'nd108-functionDialog-collapse-item1-form-item1'">
                  <el-input v-model="ds.functionSimpleSelect.fields.name" :id="'nd108-functionDialog-collapse-item1-form-item1-text'" :ref="'nd108-functionDialog-collapse-item1-form-item1-text'"></el-input>
                </el-form-item>
              </el-col>
            </el-row>
            <el-row>
              <el-col>
                <el-form-item label="描述" :id="'nd108-functionDialog-collapse-item1-form-item2'" :ref="'nd108-functionDialog-collapse-item1-form-item2'">
                  <el-input v-model="ds.functionSimpleSelect.fields.descript" :id="'nd108-functionDialog-collapse-item1-form-item2-text'" :ref="'nd108-functionDialog-collapse-item1-form-item2-text'"></el-input>
                </el-form-item>
              </el-col>
            </el-row>
            <el-row>
              <el-col>
                <el-form-item :id="'nd108-functionDialog-collapse-item1-form-item3'" :ref="'nd108-functionDialog-collapse-item1-form-item3'">
                  <el-button :id="'nd108-functionDialog-collapse-item1-form-item3-button'" :ref="'nd108-functionDialog-collapse-item1-form-item3-button'"
                    @click="queryFunctions('nd108-functionDialog-collapse-item1-form-item3-button')" binddata="ds.functionSimpleSelect"
                    refcomponent="nd108-functionDialog-collapse" callbackobj="ds.functions" url="http://10.88.1.11:18120/layout/layout/querySimpleSelectResult/false">查询</el-button>
                  <el-button :id="'nd108-functionDialog-collapse-item1-form-item3-button1'" :ref="'nd108-functionDialog-collapse-item1-form-item3-button1'"
                    @click="newFunctionNv('nd108-functionDialog')">新建</el-button>
                </el-form-item>
              </el-col>
            </el-row>
          </el-form>
        </el-collapse-item>
        <el-collapse-item title="结果" name="2" :id="'nd108-functionDialog-collapse-item2'" :ref="'nd108-functionDialog-collapse-item2'">
          <el-form :id="'nd108-functionDialog-collapse-item2-form'" :ref="'nd108-functionDialog-collapse-item2-form'">
            <el-row>
              <el-form-item :id="'nd108-functionDialog-collapse-item2-form-item1'" :ref="'nd108-functionDialog-collapse-item2-form-item1'">
                <el-button :id="'nd108-functionDialog-collapse-item2-form-item1-button'" :ref="'nd108-functionDialog-collapse-item2-form-item1-button'"
                  @click="newFunctionNv('nd108-functionDialog')">新建</el-button>
              </el-form-item>
            </el-row>
            <el-row>
              <el-form-item :id="'nd108-functionDialog-collapse-item2-form-item2'" :ref="'nd108-functionDialog-collapse-item2-form-item2'">
                <el-table @row-dblclick="functionNvDetail" :data="ds.functions" :id="'nd108-functionDialog-collapse-item2-form-item2-table'"
                  :ref="'nd108-functionDialog-collapse-item2-form-item2-table'" highlight-current-row>
                  <el-table-column label="编码" :id="'nd108-functionDialog-collapse-item2-form-item2-table-column1'" :ref="'nd108-functionDialog-collapse-item2-form-item2-table-column1'">
                    <template slot-scope="scope">
                      <el-input v-model="scope.row.fields.name" :id="'nd108-functionDialog-collapse-item2-form-item2-table-column1-text'+scope.$index"
                        :ref="'nd108-functionDialog-collapse-item2-form-item2-table-column1-text'+scope.$index"></el-input>
                    </template>
                  </el-table-column>
                  <el-table-column label="描述" :id="'nd108-functionDialog-collapse-item2-form-item2-table-column2'" :ref="'nd108-functionDialog-collapse-item2-form-item2-table-column2'">
                    <template slot-scope="scope">
                      <el-input v-model="scope.row.fields.descript" :id="'nd108-functionDialog-collapse-item2-form-item2-table-column2-text'+scope.$index"
                        :ref="'nd108-functionDialog-collapse-item2-form-item2-table-column2-text'+scope.$index"></el-input>
                    </template>
                  </el-table-column>
                </el-table>
              </el-form-item>
            </el-row>
          </el-form>
        </el-collapse-item>
        <el-collapse-item title="详情" name="3" :id="'nd108-functionDialog-collapse-item3'" :ref="'nd108-functionDialog-collapse-item3'">
          <el-form :id="'nd108-functionDialog-collapse-item3-form'" :ref="'nd108-functionDialog-collapse-item3-form'">
            <el-row>
              <el-form-item label="名称" :id="'nd108-functionDialog-collapse-item3-form-item1'" :ref="'nd108-functionDialog-collapse-item3-form-item1'">
                <el-input v-model="ds.function.fields.name" :id="'nd108-functionDialog-collapse-item3-form-item1-text'" :ref="'nd108-functionDialog-collapse-item3-form-item1-text'"></el-input>
              </el-form-item>
            </el-row>
            <el-row>
              <el-form-item label="描述" :id="'nd108-functionDialog-collapse-item3-form-item2'" :ref="'nd108-functionDialog-collapse-item3-form-item2'">
                <el-input v-model="ds.function.fields.descript" :id="'nd108-functionDialog-collapse-item3-form-item2-text'" :ref="'nd108-functionDialog-collapse-item3-form-item2-text'"></el-input>
              </el-form-item>
            </el-row>
            <el-row>
              <el-form-item label="参数" :id="'nd108-functionDialog-collapse-item3-form-item3'" :ref="'nd108-functionDialog-collapse-item3-form-item3'">
                <el-input v-model="ds.function.fields.functionParam" :id="'nd108-functionDialog-collapse-item3-form-item3-text'" :ref="'nd108-functionDialog-collapse-item3-form-item3-text'"></el-input>
              </el-form-item>
            </el-row>
            <el-row>
              <el-form-item label="方法体" :id="'nd108-functionDialog-collapse-item3-form-item4'" :ref="'nd108-functionDialog-collapse-item3-form-item4'">
                <el-input type="textarea" v-model="ds.function.fields.functionBody" :id="'nd108-functionDialog-collapse-item3-form-item4-text'"
                  :ref="'nd108-functionDialog-collapse-item3-form-item4-text'"></el-input>
              </el-form-item>
            </el-row>
            <el-row>
              <el-form-item :id="'nd108-functionDialog-collapse-item3-form-item5'" :ref="'nd108-functionDialog-collapse-item3-form-item5'">
                <el-button :id="'nd108-functionDialog-collapse-item3-form-item5-button'" :ref="'nd108-functionDialog-collapse-item3-form-item5-button'"
                  @click="saveForFunction('nd108-functionDialog-collapse-item3-form-item5-button')" binddata="ds.function"
                  bindndcode="103" callbackobj="ds.function" url="http://10.88.1.11:18120/layout/layout/saveNv/" parentid="value=0">保存并选中</el-button>
              </el-form-item>
            </el-row>
          </el-form>
        </el-collapse-item>
      </el-collapse>
    </el-dialog>
    <el-dialog :ref="'nd108-eventDialog'" :id="'nd108-eventDialog'" @close="closeDialog('nd108-eventDialog')">
      <el-form :id="'nd108-eventDialog-form'" :ref="'nd108-eventDialog-form'">
        <el-row>
          <el-col>
            <el-form-item label="触发名" :id="'nd108-eventDialog-form-item1'" :ref="'nd108-eventDialog-form-item1'">
              <el-input v-model="ds.newEvent.fields.tiggerName" :id="'nd108-eventDialog-form-item1-text'" :ref="'nd108-eventDialog-form-item1-text'"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item label="方法名" :id="'nd108-eventDialog-form-item2'" :ref="'nd108-eventDialog-form-item2'">
              <el-input v-model="ds.newEvent.fields.functionName" :id="'nd108-eventDialog-form-item2-text'" :ref="'nd108-eventDialog-form-item2-text'"
                modelstring="ds.newEvent.fields.functionName"></el-input>
              <el-button :id="'nd108-eventDialog-form-item2-button'" :ref="'nd108-eventDialog-form-item2-button'" refcomponent="nd108-eventDialog-form-item2-text"
                refparameter="userDefine.bindFunction" @click="queryFunctionName('nd108-eventDialog-form-item2-button','nd108-functionDialog')">查找</el-button>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item label="参数" :id="'nd108-eventDialog-form-item3'" :ref="'nd108-eventDialog-form-item3'">
              <el-input v-model="ds.newEvent.fields.functionParam" :id="'nd108-eventDialog-form-item3-text'" :ref="'nd108-eventDialog-form-item3-text'"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
        <el-row>
          <el-col>
            <el-form-item :id="'nd108-eventDialog-form-item4'" :ref="'nd108-eventDialog-form-item4'">
              <el-button :id="'nd108-eventDialog-form-item4-button'" :ref="'nd108-eventDialog-form-item4-button'" @click="saveForEvent('nd108-eventDialog-form-item4-button')"
                binddata="ds.newEvent" bindndcode="105" callbackobj="ds.newEvent" url="http://10.88.1.11:18120/layout/layout/saveTiggerFunctionNv/"
                parentid="data=ds.obj.fields.id">保存</el-button>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </el-dialog>
  </div>
  <div id="vue-script">
    <script> var vm = new Vue({
        el: "#nd108", data: {
          ndCode: "108",
          ds: {
          },
          url: {
          },
          userDefine: {
            activeName: "",
            bindComponent: "",
            bindFunction: ""
          }

        },
        methods: {
          newEvent(dialogName) {
            vm.newNv("105", "newEvent");
            vm.openDialog(dialogName);
          },
          queryBindName(refName, dialogName) {
            var refTemp = vm.$refs[refName];
            var refComponentName = refTemp.$attrs["refcomponent"];
            var refComponent = vm.$refs[refComponentName];
            vm.setValue(refTemp.$attrs["refparameter"], refComponent.$attrs["modelstring"]);
            vm.openDialog(dialogName);
          },
          queryFunctionName(refName, dialogName) {
            var refTemp = vm.$refs[refName];
            var refComponentName = refTemp.$attrs["refcomponent"];
            var refComponent = vm.$refs[refComponentName];
            vm.initSimpleSelect("103", "functionSimpleSelect");
            vm.openDialog(dialogName);
            vm.setValue(refTemp.$attrs["refparameter"], refComponent.$attrs["modelstring"]);
            setTimeout(function () { vm.setValue(vm.$refs[vm.$refs[dialogName].$attrs["refcomponent"]].$attrs["modelstring"], "1"); }, 1);
          },
          treeDoubleClickForDs(treeName, dialogName) {
            var tree = vm.$refs[treeName];
            var tempNode = tree.getCurrentNode();
            var callbackString = tree.$attrs["refparameter"];
            vm.setValue(eval("vm." + callbackString), tempNode.layoutTreeId);
            vm.closeDialog(dialogName);
          },
          setValue(obj, value) {
            var int = obj.lastIndexOf(".");
            var path = obj.substring(0, int);
            var name = obj.substring(int + 1);
            vm.$set(eval("vm." + path), name, value);
          },
          handleNodeClick() {
            console.log("123");
          },
          newFunctionNv(dialogName) {
            vm.getNv("103", 0, "function");
            vm.setValue(vm.$refs[vm.$refs[dialogName].$attrs["refcomponent"]].$attrs["modelstring"], "3");
          },
          functionNvDetail(row) {
            vm.getNv("103", row.fields.id, "function");
            vm.setValue(vm.$refs[vm.$refs["nd108-functionDialog"].$attrs["refcomponent"]].$attrs["modelstring"], "3");
          },
          newDs(dName, code, name) {
            vm.openDialog(dName);
            vm.newNv(code, name);
          },
          closeDialog(dialogName) {
            vm.$refs[dialogName].visible = false;
          },
          openDialog(dialogName) {
            vm.$refs[dialogName].visible = true;
          },
          initUrl() {
            var urlTemp = location.search;
            if (urlTemp.indexOf("?") != -1) {
              var str = urlTemp.substr(1);
              strs = str.split("&");
              for (var i = 0; i < strs.length; i++) {
                var tempParam = strs[i].split("=");
                vm.$set(vm.url, tempParam[0], tempParam[1]);
              }
            }
          },
          initDSTree() {
            axios.get("http://10.88.1.11:18120/layout/layout/initLayoutDS/" + vm.url.layoutId)
              .then(function (response) {
                if (response.data.success) {
                  vm.$set(vm.ds, "layoutTreeData", response.data.data);
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) { alert(error); });
          },
          newNv(code, name) {
            axios.get("http://10.88.1.11:18120/layout/layout/getNv/" + code + "/" + 0)
              .then(function (response) {
                if (response.data.success) {
                  vm.$set(vm.ds, name, response.data.data);
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          getNv(code, id, name) {
            axios.get("http://10.88.1.11:18120/layout/layout/getNv/" + code + "/" + id)
              .then(function (response) {
                if (response.data.success) {
                  vm.$set(vm.ds, name, response.data.data);
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          initBusinessDataForLayout(name) {
            var idTemp = 0;
            if (vm.url.id != undefined && vm.url.id != null) {
              idTemp = vm.url.id;
            }
            axios.get("http://10.88.1.11:18120/layout/layout/getLayoutNv/" + vm.ndCode + "/" + idTemp + "/" + vm.url.componentType)
              .then(function (response) {
                if (response.data.success) {
                  vm.$set(vm.ds, name, response.data.data);
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          saveForLayoutComponent(refName) {
            var tempButton = vm.$refs[refName];
            var tempParentId = 0;
            var tempSplitParentId = tempButton.$attrs["parentid"].split("=");
            if (tempSplitParentId[0] == "value") {
              tempParentId = tempSplitParentId[1];
            } else if (tempSplitParentId[0] == "data") {
              tempParentId = eval("vm." + tempSplitParentId[1]);
            } else {
              alert("页面配置有误，请联系系统管理员");
              return;
            }
            axios.post(tempButton.$attrs["url"] + tempButton.$attrs["bindndcode"] + "/" + tempParentId + "/" + vm.url.layoutId, eval("vm." + tempButton.$attrs["binddata"]))
              .then(function (response) {
                if (response.data.success) {
                  vm.setValue(tempButton.$attrs["callbackobj"], response.data.data);
                  var parentVm = window.parent.vm;
                  parentVm.initBusinessData("obj");
                  parentVm.initLayoutTreeData("layoutTreeData");
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          saveForFunction(refName) {
            var tempButton = vm.$refs[refName];
            var tempParentId = 0;
            var tempSplitParentId = tempButton.$attrs["parentid"].split("=");
            if (tempSplitParentId[0] == "value") {
              tempParentId = tempSplitParentId[1];
            } else if (tempSplitParentId[0] == "data") {
              tempParentId = eval("vm." + tempSplitParentId[1]);
            } else {
              alert("页面配置有误，请联系系统管理员");
              return;
            }
            axios.post(tempButton.$attrs["url"] + tempButton.$attrs["bindndcode"] + "/" + tempParentId, eval("vm." + tempButton.$attrs["binddata"]))
              .then(function (response) {
                if (response.data.success) {
                  vm.setValue(tempButton.$attrs["callbackobj"], response.data.data);
                  vm.setValue(eval("vm." + "userDefine.bindFunction"), response.data.data.fields.name);
                  vm.closeDialog("nd108-functionDialog");
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          saveForEvent(refName) {
            var tempButton = vm.$refs[refName];
            var tempParentId = 0;
            var tempSplitParentId = tempButton.$attrs["parentid"].split("=");
            if (tempSplitParentId[0] == "value") {
              tempParentId = tempSplitParentId[1];
            } else if (tempSplitParentId[0] == "data") {
              tempParentId = eval("vm." + tempSplitParentId[1]);
            } else {
              alert("页面配置有误，请联系系统管理员");
              return;
            }
            if (tempParentId == 0) {
              alert("请先保存容器");
              return;
            }
            axios.post(tempButton.$attrs["url"] + tempButton.$attrs["bindndcode"] + "/" + tempParentId + "/" + vm.url.layoutId, eval("vm." + tempButton.$attrs["binddata"]))
              .then(function (response) {
                if (response.data.success) {
                  vm.setValue(tempButton.$attrs["callbackobj"], response.data.data);
                  vm.initBusinessDataForLayout("obj");
                  vm.closeDialog("nd108-eventDialog");
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          saveForLayoutDs(refName) {
            var tempButton = vm.$refs[refName];
            var tempParentId = 0;
            var tempSplitParentId = tempButton.$attrs["parentid"].split("=");
            if (tempSplitParentId[0] == "value") {
              tempParentId = tempSplitParentId[1];
            } else if (tempSplitParentId[0] == "data") {
              tempParentId = eval("vm." + tempSplitParentId[1]);
            } else {
              alert("页面配置有误，请联系系统管理员");
              return;
            }
            axios.post(tempButton.$attrs["url"] + tempButton.$attrs["bindndcode"] + "/" + tempParentId + "/" + vm.url.layoutId, eval("vm." + tempButton.$attrs["binddata"]))
              .then(function (response) {
                if (response.data.success) {
                  vm.setValue(tempButton.$attrs["callbackobj"], response.data.data);
                  vm.initDSTree();
                  vm.closeDialog("nd108-newDsDialog");
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          initSimpleSelect(ndCode, name) {
            axios.get("http://10.88.1.11:18120/layout/layout/initSimpleSelect/" + ndCode)
              .then(function (response) {
                if (response.data.success) {
                  vm.$set(vm.ds, name, response.data.data);
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          },
          initNullDs(name) {
            vm.$set(vm.ds, name, []);
          },
          queryFunctions(refName) {
            var tempButton = vm.$refs[refName];
            axios.post(tempButton.$attrs["url"], eval("vm." + tempButton.$attrs["binddata"]))
              .then(function (response) {
                if (response.data.success) {
                  vm.setValue(tempButton.$attrs["callbackobj"], response.data.data);
                  vm.setValue(vm.$refs[tempButton.$attrs["refcomponent"]].$attrs["modelstring"], "2");
                } else {
                  alert(response.data.message);
                }
              })
              .catch(function (error) {
                alert(error);
              });
          }
        },
        mounted: function () {
          this.$nextTick(function () {
            this.initUrl();
            this.initBusinessDataForLayout("obj");
            this.initDSTree();
            this.newNv("126", "newDs");
            this.initSimpleSelect("103", "functionSimpleSelect");
            this.initNullDs("functions");
            this.newNv("103", "function");
            this.newNv("105", "newEvent");
          })
        }
      });</script> </div>
</body>

</html>